pipeline {
	agent any
	
	stages {
	
		stage ('checkout') {
			steps {
				git 'https://github.com/swapshri/maven-project.git'
			}
		}
		
		stage ('compile source code') {
			steps {
				withMaven(maven: 'My-Maven') {
					sh 'mvn compile'
				}
			}
		}
		
		stage ('test stage') {
			steps {
				withMaven(maven: 'My-Maven') {
					sh 'mvn test'
				}
			}
		}
		
		stage ('package stage') { 
			steps {
				withMaven(maven: 'My-Maven') {
					sh 'mvn package'
				}
			}
		}
		
		stage ('install stage') {
			steps {
				withMaven(maven: 'My-Maven') {
					sh 'mvn install'
				}
			}
		}	
		
		
		stage ('Deploy on Tomcat stage') {
			steps {
			  sshagent (credentials: ['54d30e8c-49e7-428c-abd5-5b4ec64bb97c']) {
                              sh 'scp -o StrictHostKeyChecking=no */target/*.war ec2-user@172.31.29.99:/var/lib/tomcat/webapps'
                          }
			
			}
		}
		
		
		
	}
}	

